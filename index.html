<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MLS-MPM Research Log</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Syne:wght@500;700;800&family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;1,300&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300&display=swap" rel="stylesheet">
  <style>
    /* ─── Design Tokens ────────────────────────────────────────────── */
    :root {
      --bg:          #080d1a;
      --bg-2:        #0c1221;
      --bg-card:     #0e1526;
      --border:      rgba(0,212,255,.1);
      --border-h:    rgba(0,212,255,.32);
      --cyan:        #00d4ff;
      --cyan-dim:    rgba(0,212,255,.55);
      --cyan-glow:   rgba(0,212,255,.12);
      --amber:       #f59e0b;
      --violet:      #a78bfa;
      --emerald:     #34d399;
      --text:        #b8ccde;
      --text-dim:    #5a7590;
      --text-muted:  #2e4258;
      --white:       #eaf4ff;
      --ff-disp:  'Orbitron',  monospace;
      --ff-head:  'Syne',      sans-serif;
      --ff-mono:  'JetBrains Mono', monospace;
      --ff-body:  'DM Sans',   sans-serif;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--ff-body);
      font-size: 15px;
      line-height: 1.65;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* dot-grid atmosphere */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        radial-gradient(ellipse 60% 60% at 15% 85%, rgba(0,212,255,.045) 0%, transparent 100%),
        radial-gradient(ellipse 50% 50% at 85% 15%, rgba(100,80,255,.04) 0%, transparent 100%),
        radial-gradient(circle, rgba(0,212,255,.055) 1px, transparent 1px);
      background-size: 100% 100%, 100% 100%, 36px 36px;
      pointer-events: none;
      z-index: 0;
    }

    /* ─── Header ───────────────────────────────────────────────────── */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      height: 62px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      background: rgba(8,13,26,.88);
      backdrop-filter: blur(18px);
      border-bottom: 1px solid var(--border);
    }
    header::after {
      content: '';
      position: absolute;
      bottom: -1px; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--cyan) 40%, var(--cyan) 60%, transparent 100%);
      opacity: .25;
    }

    .site-brand {
      display: flex;
      align-items: center;
      gap: .8rem;
      text-decoration: none;
    }
    .site-brand h1 {
      font-family: var(--ff-disp);
      font-size: .92rem;
      font-weight: 700;
      letter-spacing: .12em;
      color: var(--cyan);
      line-height: 1;
    }
    .site-badge {
      font-family: var(--ff-mono);
      font-size: .6rem;
      font-weight: 300;
      color: var(--text-dim);
      letter-spacing: .06em;
      background: rgba(0,212,255,.06);
      border: 1px solid var(--border);
      padding: .2em .65em;
      border-radius: 3px;
    }

    .hdr-right { display: flex; align-items: center; gap: 1.25rem; }

    .live-dot {
      display: flex;
      align-items: center;
      gap: .45rem;
      font-family: var(--ff-mono);
      font-size: .65rem;
      color: var(--text-dim);
    }
    .live-dot i {
      display: inline-block;
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--cyan);
      box-shadow: 0 0 8px var(--cyan);
      animation: blink 2.4s ease-in-out infinite;
    }
    @keyframes blink {
      0%,100% { opacity: 1; transform: scale(1); }
      50%      { opacity: .35; transform: scale(.65); }
    }

    .gh-btn {
      display: inline-flex;
      align-items: center;
      gap: .4em;
      font-family: var(--ff-mono);
      font-size: .7rem;
      color: var(--text-dim);
      text-decoration: none;
      border: 1px solid var(--border);
      padding: .35em 1em;
      border-radius: 4px;
      transition: color .18s, border-color .18s, background .18s;
    }
    .gh-btn:hover {
      color: var(--cyan);
      border-color: var(--cyan-dim);
      background: var(--cyan-glow);
    }

    /* ─── Layout ───────────────────────────────────────────────────── */
    .wrap {
      position: relative;
      z-index: 1;
      max-width: 1160px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      display: grid;
      grid-template-columns: 270px 1fr;
      gap: 2rem;
      align-items: start;
    }

    /* ─── Sidebar ──────────────────────────────────────────────────── */
    .sidebar {
      position: sticky;
      top: 80px;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .panel {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .panel-hdr {
      padding: .65rem 1rem;
      background: rgba(0,212,255,.035);
      border-bottom: 1px solid var(--border);
      font-family: var(--ff-mono);
      font-size: .6rem;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--cyan-dim);
      display: flex;
      justify-content: space-between;
    }

    /* ── Calendar ── */
    .cal-wrap { padding: .9rem; }

    .cal-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: .85rem;
    }
    .cal-month-lbl {
      font-family: var(--ff-head);
      font-size: .88rem;
      font-weight: 700;
      color: var(--white);
    }
    .cal-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-dim);
      width: 26px; height: 26px;
      border-radius: 3px;
      cursor: pointer;
      font-size: .85rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color .15s, border-color .15s;
    }
    .cal-btn:hover { color: var(--cyan); border-color: var(--cyan-dim); }

    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7,1fr);
      gap: 2px;
    }
    .cal-dow {
      font-family: var(--ff-mono);
      font-size: .55rem;
      color: var(--text-muted);
      text-align: center;
      padding: .3rem 0;
      letter-spacing: .04em;
    }
    .cal-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--ff-mono);
      font-size: .68rem;
      border-radius: 3px;
      color: var(--text-muted);
      position: relative;
      cursor: default;
    }
    .cal-day.has-posts {
      color: var(--text);
      cursor: pointer;
      transition: background .15s, color .15s;
    }
    .cal-day.has-posts::after {
      content: '';
      position: absolute;
      bottom: 2px; left: 50%;
      transform: translateX(-50%);
      width: 3px; height: 3px;
      border-radius: 50%;
      background: var(--cyan);
      box-shadow: 0 0 5px var(--cyan);
    }
    .cal-day.has-posts:hover { background: var(--cyan-glow); color: var(--cyan); }
    .cal-day.active {
      background: var(--cyan) !important;
      color: var(--bg) !important;
      font-weight: 600;
    }
    .cal-day.active::after { display: none; }
    .cal-day.today { color: var(--cyan-dim); }

    .cal-clear {
      display: none;
      width: 100%;
      margin-top: .65rem;
      padding: .38rem;
      background: none;
      border: 1px solid rgba(0,212,255,.18);
      border-radius: 4px;
      color: var(--text-dim);
      font-family: var(--ff-mono);
      font-size: .6rem;
      letter-spacing: .06em;
      text-transform: uppercase;
      cursor: pointer;
      transition: color .15s, border-color .15s;
    }
    .cal-clear.on { display: block; }
    .cal-clear:hover { color: var(--cyan); border-color: var(--cyan-dim); }

    /* ── Stats ── */
    .stats { padding: .7rem 1rem; }
    .stat { display: flex; justify-content: space-between; padding: .32rem 0; }
    .stat + .stat { border-top: 1px solid rgba(255,255,255,.03); }
    .stat-k {
      font-family: var(--ff-mono);
      font-size: .6rem;
      text-transform: uppercase;
      letter-spacing: .09em;
      color: var(--text-dim);
    }
    .stat-v {
      font-family: var(--ff-mono);
      font-size: .68rem;
      color: var(--cyan-dim);
    }

    /* ─── Main ─────────────────────────────────────────────────────── */
    .main { min-width: 0; }

    /* ── Filter pills ── */
    .filter-bar {
      display: flex;
      align-items: center;
      gap: .45rem;
      margin-bottom: 1.35rem;
      flex-wrap: wrap;
    }
    .filter-lbl {
      font-family: var(--ff-mono);
      font-size: .6rem;
      text-transform: uppercase;
      letter-spacing: .1em;
      color: var(--text-muted);
      margin-right: .2rem;
    }
    .pill {
      font-family: var(--ff-mono);
      font-size: .68rem;
      padding: .32em 1.05em;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: none;
      color: var(--text-dim);
      cursor: pointer;
      letter-spacing: .03em;
      transition: color .18s, border-color .18s, background .18s, box-shadow .18s;
    }
    .pill:hover { border-color: var(--cyan-dim); color: var(--text); }
    .pill.on                { background: var(--cyan);    border-color: var(--cyan);    color: var(--bg); font-weight: 600; box-shadow: 0 0 14px rgba(0,212,255,.28); }
    .pill[data-c="slides"].on { background: var(--amber);   border-color: var(--amber);   color: #1a0a00; box-shadow: 0 0 14px rgba(245,158,11,.28); }
    .pill[data-c="code"].on   { background: var(--violet);  border-color: var(--violet);  color: #0d0a1a; box-shadow: 0 0 14px rgba(167,139,250,.28); }
    .pill[data-c="vids"].on   { background: var(--emerald); border-color: var(--emerald); color: #011a0e; box-shadow: 0 0 14px rgba(52,211,153,.28); }

    .results-meta {
      font-family: var(--ff-mono);
      font-size: .62rem;
      color: var(--text-muted);
      margin-bottom: 1.25rem;
      min-height: 1em;
    }

    /* ── Post cards ── */
    .posts { display: flex; flex-direction: column; gap: 1.25rem; }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      transition: border-color .22s, box-shadow .22s;
      animation: rise .38s ease both;
    }
    @keyframes rise {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0);     }
    }
    .card:hover {
      border-color: var(--border-h);
      box-shadow: 0 0 32px rgba(0,212,255,.07), 0 2px 12px rgba(0,0,0,.4);
    }
    /* top accent stripe */
    .card::before {
      content: '';
      display: block;
      height: 2px;
    }
    .card.c-vids.c-slides::before { background: linear-gradient(90deg, var(--emerald) 0%, var(--amber) 60%, transparent 100%); }
    .card.c-vids::before           { background: linear-gradient(90deg, var(--emerald), transparent 70%); }
    .card.c-slides::before         { background: linear-gradient(90deg, var(--amber),   transparent 70%); }
    .card.c-code::before           { background: linear-gradient(90deg, var(--violet),  transparent 70%); }

    /* video block */
    .vid-block {
      background: #000;
      border-bottom: 1px solid var(--border);
    }
    .vid-block video {
      width: 100%;
      display: block;
      max-height: 360px;
      object-fit: contain;
    }

    /* card body */
    .card-body { padding: 1.2rem 1.4rem; }

    .card-meta {
      display: flex;
      align-items: center;
      gap: .65rem;
      margin-bottom: .7rem;
      flex-wrap: wrap;
    }
    .phase-badge {
      font-family: var(--ff-mono);
      font-size: .58rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: .09em;
      background: var(--cyan-glow);
      border: 1px solid rgba(0,212,255,.22);
      color: var(--cyan-dim);
      padding: .15em .6em;
      border-radius: 3px;
    }
    .post-date {
      font-family: var(--ff-mono);
      font-size: .62rem;
      color: var(--text-dim);
    }
    .tags { display: flex; gap: .35rem; margin-left: auto; flex-wrap: wrap; }
    .tag {
      font-family: var(--ff-mono);
      font-size: .56rem;
      text-transform: uppercase;
      letter-spacing: .05em;
      padding: .13em .5em;
      border-radius: 3px;
      border: 1px solid;
      display: inline-flex;
      align-items: center;
      gap: .3em;
    }
    .tag.slides { color: var(--amber);   border-color: rgba(245,158,11,.25);  background: rgba(245,158,11,.06); }
    .tag.code   { color: var(--violet);  border-color: rgba(167,139,250,.25); background: rgba(167,139,250,.06); }
    .tag.vids   { color: var(--emerald); border-color: rgba(52,211,153,.25);  background: rgba(52,211,153,.06); }

    .card-title {
      font-family: var(--ff-head);
      font-size: 1.12rem;
      font-weight: 800;
      color: var(--white);
      line-height: 1.28;
      margin-bottom: .2rem;
    }
    .card-sub {
      font-family: var(--ff-mono);
      font-size: .68rem;
      font-style: italic;
      color: var(--text-dim);
      margin-bottom: .75rem;
    }
    .card-desc {
      font-size: .875rem;
      color: var(--text);
      line-height: 1.7;
      margin-bottom: 1rem;
    }

    .card-links { display: flex; gap: .65rem; flex-wrap: wrap; }
    .lnk {
      display: inline-flex;
      align-items: center;
      gap: .38em;
      font-family: var(--ff-mono);
      font-size: .65rem;
      text-decoration: none;
      padding: .38em .95em;
      border-radius: 4px;
      border: 1px solid;
      transition: background .18s, border-color .18s;
    }
    .lnk-slides { color: var(--amber);   border-color: rgba(245,158,11,.22);  background: rgba(245,158,11,.04); }
    .lnk-slides:hover { background: rgba(245,158,11,.1); border-color: var(--amber); }
    .lnk-code   { color: var(--violet);  border-color: rgba(167,139,250,.22); background: rgba(167,139,250,.04); }
    .lnk-code:hover   { background: rgba(167,139,250,.1); border-color: var(--violet); }

    /* empty state */
    .empty {
      display: none;
      text-align: center;
      padding: 4rem 2rem;
      font-family: var(--ff-mono);
      font-size: .72rem;
      color: var(--text-muted);
    }
    .empty.on { display: block; }
    .empty-icon { font-size: 1.8rem; margin-bottom: .6rem; opacity: .25; }

    /* ─── Responsive ───────────────────────────────────────────────── */
    @media (max-width: 780px) {
      .wrap { grid-template-columns: 1fr; padding: 1rem; }
      .sidebar { position: static; }
      header { padding: 0 1rem; }
      .site-badge, .live-dot { display: none; }
    }
  </style>
</head>
<body>

<!-- ══════════════════════════════════════════════════════ HEADER -->
<header>
  <a href="#" class="site-brand">
    <h1>MLS&#8209;MPM&nbsp;LOG</h1>
    <span class="site-badge">Taichi · SIGGRAPH 2018</span>
  </a>
  <div class="hdr-right">
    <div class="live-dot"><i></i> 270K particles</div>
    <a href="https://github.com/Qervas/taichi" class="gh-btn" target="_blank" rel="noopener">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.21 11.39.6.11.79-.26.79-.58v-2.23c-3.34.73-4.03-1.42-4.03-1.42-.55-1.39-1.34-1.76-1.34-1.76-1.09-.74.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.81 1.3 3.49 1 .11-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.3-1.55 3.3-1.23 3.3-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.82 1.1.82 2.22v3.29c0 .32.19.69.8.58C20.56 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/></svg>
      GitHub
    </a>
  </div>
</header>

<!-- ══════════════════════════════════════════════════════ LAYOUT -->
<div class="wrap">

  <!-- ───────────────── SIDEBAR -->
  <aside class="sidebar">

    <!-- Calendar -->
    <div class="panel">
      <div class="panel-hdr">
        <span>// Date Filter</span>
        <span id="calInfo"></span>
      </div>
      <div class="cal-wrap">
        <div class="cal-nav">
          <button class="cal-btn" id="calPrev">&#8249;</button>
          <span class="cal-month-lbl" id="calLbl"></span>
          <button class="cal-btn" id="calNext">&#8250;</button>
        </div>
        <div class="cal-grid" id="calGrid"></div>
        <button class="cal-clear" id="calClear">✕ &nbsp;Clear date filter</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="panel">
      <div class="panel-hdr"><span>// Simulation Scale</span></div>
      <div class="stats">
        <div class="stat"><span class="stat-k">Algorithm</span>  <span class="stat-v">MLS-MPM</span></div>
        <div class="stat"><span class="stat-k">Max Particles</span><span class="stat-v">270 K</span></div>
        <div class="stat"><span class="stat-k">Framework</span>   <span class="stat-v">Taichi Lang</span></div>
        <div class="stat"><span class="stat-k">Phases</span>      <span class="stat-v">4</span></div>
        <div class="stat"><span class="stat-k">Transfer</span>    <span class="stat-v">APIC</span></div>
        <div class="stat"><span class="stat-k">Reference</span>   <span class="stat-v">SIGGRAPH 2018</span></div>
      </div>
    </div>

  </aside>

  <!-- ───────────────── MAIN -->
  <main class="main">

    <div class="filter-bar">
      <span class="filter-lbl">Filter:</span>
      <button class="pill on" data-c="all">All</button>
      <button class="pill" data-c="slides">Slides</button>
      <button class="pill" data-c="code">Code</button>
      <button class="pill" data-c="vids">Vids</button>
    </div>

    <div class="results-meta" id="meta"></div>
    <div class="posts" id="posts"></div>
    <div class="empty" id="empty">
      <div class="empty-icon">◈</div>
      No posts match the current filter.
    </div>

  </main>
</div><!-- .wrap -->

<script>
/* ━━━━━━━━━━━━━━━━━━━━ DATA ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
const POSTS = [
  {
    id: 1,
    phase: "Phase 01",
    title: "Smoke Simulation",
    subtitle: "Introduction to particle-based fluid dynamics",
    date: "2026-02-25",
    categories: ["slides"],
    description:
      "Kick-off of the MLS-MPM series. Covers the foundational grid-based P2G / G2P transfer schemes and the APIC formulation that preserves angular momentum without artificial viscosity. Presented as a walk-through of the theory before any fluid solver is written.",
    slides: "slides/phase1-smoke-simulation.pptx",
  },
  {
    id: 2,
    phase: "Phase 02",
    title: "2D Water Dam Break",
    subtitle: "Weakly compressible MLS-MPM with EOS pressure",
    date: "2026-02-26",
    categories: ["code", "vids", "slides"],
    description:
      "A 2D dam-break simulation on a 128×128 collocated grid with ~50 K water particles (4 per cell). Pressure is computed per-particle via a two-sided equation of state — p = K(1 − J) — resisting both compression and expansion. The APIC affine matrix C doubles as the velocity gradient, giving accurate angular-momentum conservation at zero extra cost.",
    video: "videos/mlsmpm1.mp4",
    slides: "slides/phase2-4-mls-mpm.pptx",
    code: "https://github.com/Qervas/taichi/blob/main/src/phase2_water.py",
  },
  {
    id: 3,
    phase: "Phase 03",
    title: "3D Bridge Destruction",
    subtitle: "Drucker-Prager fracture with two-phase MPM coupling",
    date: "2026-02-26",
    categories: ["code", "vids", "slides"],
    description:
      "A wall of water impacts four bridge pillars on a 64³ grid (270 K particles: 248 K water + 21.6 K solid). Solid uses Drucker-Prager elastoplasticity with SVD-based return mapping. Damage accumulates as yield strain exceeds a threshold, progressively degrading cohesion and triggering cascading shattering. Water and solid couple automatically through the shared MPM grid — no explicit coupling terms needed.",
    video: "videos/mlsmpm2.mp4",
    slides: "slides/phase2-4-mls-mpm.pptx",
    code: "https://github.com/Qervas/taichi/blob/main/src/phase3_3d.py",
  },
  {
    id: 4,
    phase: "Phase 04",
    title: "Flood vs. Concrete Bridge",
    subtitle: "River-scale simulation on an elongated 128×64×64 domain",
    date: "2026-02-26",
    categories: ["code", "slides"],
    description:
      "Extends Phase 3 to a full river-flood scenario. The domain is doubled in the flow direction (128×64×64, dx = 1/64) to accommodate a bridge spanning the width of the channel. Water uses weakly compressible EOS; the concrete structure uses Drucker-Prager with elevated yield stress (E = 10 000). CFL-safe timestep dt = 8×10⁻⁵ s, 80 substeps per frame.",
    slides: "slides/phase2-4-mls-mpm.pptx",
    code: "https://github.com/Qervas/taichi/blob/main/src/phase4_flood.py",
  },
];

/* ━━━━━━━━━━━━━━━━━━━━ STATE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
let activeCat  = "all";
let activeDate = null;
let calY = 2026, calM = 1;   // 0-indexed month; 1 = February

const POST_DATES = new Set(POSTS.map(p => p.date));
const MONTHS = ["January","February","March","April","May","June",
                "July","August","September","October","November","December"];
const DOW    = ["Su","Mo","Tu","We","Th","Fr","Sa"];
const today  = new Date();

/* ━━━━━━━━━━━━━━━━━━━━ CALENDAR ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
function renderCal() {
  const grid = document.getElementById("calGrid");
  document.getElementById("calLbl").textContent = `${MONTHS[calM]} ${calY}`;
  grid.innerHTML = "";

  DOW.forEach(d => {
    const el = document.createElement("div");
    el.className = "cal-dow";
    el.textContent = d;
    grid.appendChild(el);
  });

  const firstDow   = new Date(calY, calM, 1).getDay();
  const daysInMo   = new Date(calY, calM + 1, 0).getDate();

  for (let i = 0; i < firstDow; i++)
    grid.appendChild(document.createElement("div"));

  for (let d = 1; d <= daysInMo; d++) {
    const ds = `${calY}-${String(calM+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const el = document.createElement("div");
    el.className = "cal-day";
    el.textContent = d;

    const todayDs = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")}`;
    if (ds === todayDs)    el.classList.add("today");
    if (POST_DATES.has(ds)) el.classList.add("has-posts");
    if (ds === activeDate)  el.classList.add("active");

    if (POST_DATES.has(ds)) {
      el.addEventListener("click", () => {
        activeDate = activeDate === ds ? null : ds;
        renderCal();
        renderPosts();
        toggleClear();
      });
    }
    grid.appendChild(el);
  }
}

function toggleClear() {
  document.getElementById("calClear").classList.toggle("on", !!activeDate);
}

document.getElementById("calClear").addEventListener("click", () => {
  activeDate = null; renderCal(); renderPosts(); toggleClear();
});
document.getElementById("calPrev").addEventListener("click", () => {
  calM--; if (calM < 0)  { calM = 11; calY--; } renderCal();
});
document.getElementById("calNext").addEventListener("click", () => {
  calM++; if (calM > 11) { calM = 0;  calY++; } renderCal();
});

/* ━━━━━━━━━━━━━━━━━━━━ CATEGORY FILTER ━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
document.querySelectorAll(".pill").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".pill").forEach(b => b.classList.remove("on"));
    btn.classList.add("on");
    activeCat = btn.dataset.c;
    renderPosts();
  });
});

/* ━━━━━━━━━━━━━━━━━━━━ RENDER POSTS ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
const IC = {
  slides:   `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>`,
  code:     `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`,
  vids:     `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>`,
  download: `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>`,
  ext:      `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>`,
};

function fmtDate(ds) {
  const [y,m,d] = ds.split("-").map(Number);
  return `${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][m-1]} ${d}, ${y}`;
}

function getFiltered() {
  return POSTS.filter(p =>
    (activeCat === "all" || p.categories.includes(activeCat)) &&
    (!activeDate || p.date === activeDate)
  );
}

function buildCard(post, idx) {
  const card = document.createElement("div");
  card.className = "card";
  post.categories.forEach(c => card.classList.add("c-" + c));
  card.style.animationDelay = `${idx * 0.07}s`;

  const vidHtml = post.video
    ? `<div class="vid-block">
         <video controls preload="metadata" playsinline>
           <source src="${post.video}" type="video/mp4">
         </video>
       </div>`
    : "";

  const tagHtml = post.categories.map(c =>
    `<span class="tag ${c}">${IC[c]} ${c}</span>`
  ).join("");

  let links = "";
  if (post.slides) links += `<a href="${post.slides}" class="lnk lnk-slides" download>${IC.download} Slides (PPTX)</a>`;
  if (post.code)   links += `<a href="${post.code}"   class="lnk lnk-code"   target="_blank" rel="noopener">${IC.ext} View Code</a>`;

  card.innerHTML = `
    ${vidHtml}
    <div class="card-body">
      <div class="card-meta">
        <span class="phase-badge">${post.phase}</span>
        <span class="post-date">${fmtDate(post.date)}</span>
        <div class="tags">${tagHtml}</div>
      </div>
      <h2 class="card-title">${post.title}</h2>
      <p  class="card-sub">${post.subtitle}</p>
      <p  class="card-desc">${post.description}</p>
      ${links ? `<div class="card-links">${links}</div>` : ""}
    </div>`;

  return card;
}

function renderPosts() {
  const list  = document.getElementById("posts");
  const empty = document.getElementById("empty");
  const meta  = document.getElementById("meta");
  const items = getFiltered();

  list.innerHTML = "";

  if (!items.length) {
    empty.classList.add("on");
    meta.textContent = "";
    return;
  }
  empty.classList.remove("on");

  let m = `${items.length} post${items.length !== 1 ? "s" : ""}`;
  if (activeDate) m += ` · ${fmtDate(activeDate)}`;
  if (activeCat !== "all") m += ` · #${activeCat}`;
  meta.textContent = m;

  items.forEach((p, i) => list.appendChild(buildCard(p, i)));
}

/* ━━━━━━━━━━━━━━━━━━━━ INIT ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
renderCal();
renderPosts();
</script>
</body>
</html>
